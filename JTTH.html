<input type="hidden" name="attr_sheet_version" value="2.0">
<input type="hidden" name="attr_character_type" value="mortal">
<input type="hidden" name="attr_is_beast" value="0">
<input type="hidden" name="attr_show_char_creation" value="1">
<input type="hidden" name="attr_level_up_mode" value="0">

<!-- Page Navigation Radios -->
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_char_creation" value="char_creation" checked>
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_mortal" value="mortal">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_cultivator" value="cultivator">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_beast" value="beast">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_combat" value="combat">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_techniques" value="techniques">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_bio" value="bio">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_notes" value="notes">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_inventory" value="inventory">
<input type="radio" name="attr_page" class="sheet-page-radio" id="attr_page_options" value="options">

<div class="sheet-container">
    <!-- Roll Settings -->
    <div class="sheet-roll-settings">
        <label>
            <input type="radio" name="attr_whisper" value="" checked>
            <span title="@{whispertoggle}">Public</span>
        </label>
        <label>
            <input type="radio" name="attr_whisper" value="/w gm ">
            <span title="@{whispertoggle}">To GM</span>
        </label>
    </div>

    <!-- Character Header -->
    <div class="sheet-header">
        <div class="sheet-avatar">
            <img name="attr_character_avatar">
        </div>
        <div class="sheet-info">
            <div class="sheet-field">
                <label>Name:</label>
                <input type="text" name="attr_character_name">
            </div>
            <div class="sheet-field">
                <label>Ancestry & Species:</label>
                <span name="attr_anc_spe" class="sheet-anc-spe-display"></span>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="sheet-tabs">
        <label class="sheet-tab sheet-tab-char-creation" for="attr_page_char_creation">Character Creation</label>
        <label class="sheet-tab sheet-tab-mortal" for="attr_page_mortal">Mortal</label>
        <label class="sheet-tab sheet-tab-cultivator" for="attr_page_cultivator">Cultivator</label>
        <label class="sheet-tab sheet-tab-beast" for="attr_page_beast">Beast</label>
        <label class="sheet-tab sheet-tab-combat" for="attr_page_combat">Combat</label>
        <label class="sheet-tab sheet-tab-techniques" for="attr_page_techniques">Techniques</label>
        <label class="sheet-tab sheet-tab-bio" for="attr_page_bio">Bio</label>
        <label class="sheet-tab sheet-tab-notes" for="attr_page_notes">Notes</label>
        <label class="sheet-tab sheet-tab-inventory" for="attr_page_inventory">Inventory</label>
        <label class="sheet-tab sheet-tab-options" for="attr_page_options">Options</label>
    </div>

    <!-- Page Content -->
    <div class="sheet-content">
        <!-- Character Creation Page -->
        <div class="sheet-page sheet-page-char-creation">
            <input type="hidden" name="attr_creation_step" value="0">
            
            <!-- Path type radios (control both Path and Dao steps) -->
            <input type="radio" name="attr_path_type" value="mortal" id="path-mortal" checked>
            <input type="radio" name="attr_path_type" value="cultivator" id="path-cultivator">
            
            <!-- Stats substep control -->
            <input type="checkbox" name="attr_show_stats_starting" value="1" checked style="display: none;">
            <input type="checkbox" name="attr_show_stats_realm" value="1" style="display: none;">
            <input type="checkbox" name="attr_show_stats_finalize" value="1" style="display: none;">
            
            <!-- Step Navigation -->
            <div class="sheet-step-tabs">
                <button type="action" name="act_step_tab_0" class="sheet-step-tab sheet-step-tab-0">Welcome</button>
                <button type="action" name="act_step_tab_1" class="sheet-step-tab sheet-step-tab-1">Ancestry</button>
                <button type="action" name="act_step_tab_2" class="sheet-step-tab sheet-step-tab-2">Species</button>
                <button type="action" name="act_step_tab_3" class="sheet-step-tab sheet-step-tab-3">Path</button>
                <button type="action" name="act_step_tab_4" class="sheet-step-tab sheet-step-tab-4">Dao</button>
                <button type="action" name="act_step_tab_5" class="sheet-step-tab sheet-step-tab-5">Stats</button>
                <button type="action" name="act_step_tab_complete" class="sheet-step-tab sheet-step-tab-complete">Complete</button>
            </div>
            
            <!-- Step 0: Welcome Screen -->
            <div class="sheet-creation-step sheet-creation-welcome">
                <h2>Welcome to Journey to the Heavens</h2>
                <div class="sheet-welcome-content">
                    <p>Welcome, aspiring cultivator, to the <strong>Journey to the Heavens Character Creator</strong>.</p>
                    <p>This guided process will help you forge your path through the realms of cultivation, from humble mortal beginnings to the heights of power.</p>
                    <p>Before you begin, we recommend reviewing:</p>
                    <ul><li><strong>JTTH Wiki</strong> - For detailed information about the world, cultivation, and game mechanics<li><strong>Trello Board</strong> - For updates, rules clarifications, and additional resources</ul>
                    <p>Your journey begins with a single step. Are you ready to walk the path of cultivation?</p>
                </div>
                <div class="sheet-creation-buttons">
                    <button type="action" name="act_cancel_creation" class="sheet-btn-cancel">Cancel</button>
                    <button type="action" name="act_next_step" class="sheet-btn-next">Next</button>
                </div>
            </div>

            <!-- Ancestry Radio Inputs (must be sibling of both ancestry and species steps) -->
            <input type="radio" name="attr_ancestry" value="human" id="anc-human" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="demihuman" id="anc-demihuman" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="beastman" id="anc-beastman" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="giant" id="anc-giant" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="fishman" id="anc-fishman" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="plantkin" id="anc-plantkin" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="lunarian" id="anc-lunarian" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="crawler" id="anc-crawler" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="demon" id="anc-demon" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="sentient_beast" id="anc-sentient-beast" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="slimekin" id="anc-slimekin" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="solarian" id="anc-solarian" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="yokai" id="anc-yokai" class="sheet-hide">
            <input type="radio" name="attr_ancestry" value="winged_race" id="anc-winged-race" class="sheet-hide">

            <!-- Step 1: Ancestry Selection -->
            <div class="sheet-creation-step sheet-creation-ancestry">
                <h2>Step 1: Choose Your Ancestry</h2>
                
                <div class="sheet-ancestry-content">
                    <div class="sheet-ancestry-grid">
                        <label for="anc-human">Human</label>
                        <label for="anc-demihuman">Demihuman</label>
                        <label for="anc-beastman">Beastman</label>
                        <label for="anc-giant">Giant Race</label>
                        <label for="anc-fishman">Fishman</label>
                        <label for="anc-plantkin">Plantkin</label>
                        <label for="anc-lunarian">Lunarian</label>
                        <label for="anc-crawler">Crawler</label>
                        <label for="anc-demon">Demon</label>
                        <label for="anc-sentient-beast">Sentient Beast</label>
                        <label for="anc-slimekin">Slimekin</label>
                        <label for="anc-solarian">Solarian</label>
                        <label for="anc-yokai">Yokai</label>
                        <label for="anc-winged-race">Winged Race</label>
                    </div>

                <div class="sheet-ancestry-info-display">
                    <div class="sheet-info-placeholder">Select an ancestry to view details</div>
                    
                    <div class="sheet-info-block sheet-info-human">
                        <h3>Human</h3><hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 1/10<li>Speed: 1/10<li>Cultivation Speed: 8/10 (+30%)<li>Lifespan: 1/10 (-25%)<li>Durability: 1/10<li>Potential: 10/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Versatility through Neutrality - Can pursue any Dao<li>Bloodline Integration - Can absorb another bloodline<li>The Potential of a Firework - +30% cultivation speed<li>The Earliest Learners - Higher Law sensitivity</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Shortest lifespan among all races<li>Physically weak and slow (Base)<li>Dull senses (Base)</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>None (Can pursue any Dao)</ul><hr>
                        <p><strong>Species:</strong> None</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-demihuman">
                        <h3>Demihuman</h3><hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 6/10<li>Speed: 6/10<li>Cultivation Speed: 6/10 (+10%)<li>Lifespan: 4/10 (-10%)<li>Durability: 6/10<li>Potential: Depends/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Half Beast, Half Man - Above-average stats<li>Mating season once a year</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Limited by Bloodline Quality (Roll 1d10,000)<li>Class Restrictions apply</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>All Martial Dao + Body Refiner<li>All Elemental Dao</ul><hr>
                        <p><strong>Species:</strong> Varies by bloodline (determined by roll)</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-beastman">
                        <h3>Beastman</h3><hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 8/10<li>Speed: 8/10<li>Cultivation Speed: 4/10 (-10%)<li>Lifespan: 7/10 (+20%)<li>Durability: 7.5/10<li>Potential: Depends/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Sentient Mind, Bestial Body - Formidable physiques<li>Strong, fast, and durable<li>Mating season once a year</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Below average cultivation speed (-10%)<li>Very limited by Bloodline Quality (Roll 1d10,000)</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>All Martial Dao + Body Refiner</ul><hr>
                        <p><strong>Species:</strong> Varies by bloodline (determined by roll)</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-giant">
                        <h3>Giant Race (Costs 2 Lives)</h3><hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 10/10<li>Speed: 4/10<li>Cultivation Speed: 6.5/10<li>Lifespan: 10/10 (+50%)<li>Durability: 8.5/10<li>Potential: 7/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Giant's Body - +50% Qi/PWR/HP, 2x Durability, 3-6m tall<li>Ancestor's Sturdiness - Harder to injure, damage reduction<li>Innate Bloodline - Purity affects strength/status<li>Extreme Earth Affinity - 1:1 Freestyling with Earth Qi</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Non-compatible with AGI Classes<li>Low Evasion<li>Costs 2 Lives</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>Earth Dao (Major Synergy)<li>Body Refining (Fist, Palm)<li>All PWR-based Dao</ul><hr>
                        <p><strong>Species:</strong> None</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-fishman">
                        <h3>Fishman (Costs 2 Lives)</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 7/10<li>Speed: 4/10 land / 10/10 water<li>Cultivation Speed: 5.5/10<li>Lifespan: 5/10<li>Durability: 5/10 land / 8.5/10 water<li>Potential: 7.5/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Child of the Deep - 50% more damage underwater<li>Strength/Calm of the Deep - +35% PWR/MTL<li>Mental Fortress - 2x Mental Fortitude<li>Rehydrated Scales - 2x Durability underwater<li>Slippery as an Eel - 2x Evasion underwater<li>Strong Swimmer - 2x Movement underwater<li>Friend of the Deep - Communicate with aquatic creatures<li>Psychic Sonar - Mental shockwave attacks<li>Innate Bloodline - Purity paramount</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Weak to Fire and Lightning<li>Can dry out in extreme heat<li>Slowed in extreme cold<li>Costs 2 Lives</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>Water Dao<li>Mind Dao<li>Spear / Psychic (Spear Variant)<li>Poison Dao<li>PWR Fist Body Refiner</ul><hr>
                        <p><strong>Affinities:</strong> Water, Mind, Poison</p><hr>
                        <p><strong>Species:</strong> None (various sea beast descendants)</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-plantkin">
                        <h3>Plantkin</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 6/10<li>Speed: 6/10<li>Cultivation Speed: 6.5/10<li>Lifespan: 9/10 (+40%)<li>Durability: 9/10<li>Potential: 8/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Fibrous Flesh - 2x Durability, +100% Max HP, Flat damage reduction<li>Herb Integration - 1 per Major Realm (2 if Genius)<li>Photosynthesis - 5% Qi Regeneration<li>Friend of the Trees - Communicate with plants<li>Extreme Wood Affinity - 1:1 Qi Improv. Ratio<li>Herb Origin - Choose spiritual herb type</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>No healing via pills (Wood Qi only)<li>Weakened in extreme temps/Qi-poor areas<li>Limited Dao (No Generalists)<li>Emotions aren't really your thing</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>Wood Dao (Major Synergy, only Element)<li>All Martial Dao except BR</ul><hr>
                        <p><strong>Affinities:</strong> Wood Dao (Major Synergy)</p><hr>
                        <p><strong>Species:</strong> Blue Spirit Grass, Red Spirit Grass, Ten Blade Lotus, 100 Year Yang Flower, Parasitic Skullfruit, 100 Year Yin Vine, Bloodthistle, Venomleaf, Ether Lily, Starbloom Orchid, Golden Crown Bamboo</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-lunarian">
                        <h3>Lunarian</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 3/10<li>Speed: 7/10 (11/10 night, 15/10 Full Moon)<li>Cultivation Speed: 7/10<li>Lifespan: 8/10 (+20%)<li>Durability: 3/10<li>Potential: 8.5/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Lunar Litheness - 3x Movement at night<li>One with the Moon - Enhanced senses at night<li>Lunar Avatar - 2x AGI/Movement/damage under Full Moon, Lunar Gleam attack<li>Midnight Lethality - 3x Critical damage at night<li>Lunar Glow - Additional Pure Yin damage at night<li>Tides of the Night - 1:1 Freestyle Qi efficiency<li>Cover of the Moon - Harder to sense at night<li>Lunar Affinity - High affinity with Pure Yin and Yin Ice</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Weakened in sunlight (halved damage dealt, doubled taken)<li>Not particularly strong physically<li>Speed consumables only work during day</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>Pure Yin<li>Ice Dao<li>Assassination Dao</ul><hr>
                        <p><strong>Affinities:</strong> Pure Yin, Ice Dao, Assassination Dao</p><hr>
                        <p><strong>Species:</strong> None</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-crawler">
                        <h3>Crawler (Costs 2 Lives)</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 8/10<li>Speed: 8/10<li>Cultivation Speed: 7/10<li>Lifespan: 3/10<li>Durability: 8/10 (4/10 without exoskeleton)<li>Potential: 8/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Natural Armour - Exoskeleton with Body Refiner-level defense<li>Keen Feelers - Enhanced senses, detect ambushes<li>The Peak of Evolution - +4/20/50 to PWR/AGI/VIT at QG/Found./CF</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Wings vulnerable (double damage, 20% Max HP injury threshold)<li>Exoskeleton can break (75% Max HP damage threshold)<li>Costs 2 Lives</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>Martial Dao<li>Poison Dao</ul><hr>
                        <p><strong>Affinities:</strong> Martial Dao, Poison Dao</p><hr>
                        <p><strong>Species:</strong> Ant, Wasp, Hornet, Centipede, Mantis, Grasshopper, Venomous Spider, Millipede, Beetle, Scorpion, Butterfly/Moth, Fleas, Termite, Dragonfly, Bee, Hunting Spider/Tarantula</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-demon">
                        <h3>Demon (Evil Playthrough)</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 9.5/10<li>Speed: 9.5/10<li>Cultivation Speed: N/A<li>Lifespan: 10/10 (+50%)<li>Durability: 10/10<li>Potential: 10/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Descendants of Apex Existences - Extremely formidable<li>Darwin's Worst Nightmare - Continuously evolve adaptive traits<li>Player-Killing Enjoyer - Hunts non-Demon Players<li>Consume and Adapt - Consume souls to fuel evolution<li>Killing Machine - Requires 2-3 equal realm cultivators to match</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Bloodthirsty<li>Easy to sense (most of the time)<li>Hunts all other non-Demon Players<li>Under absolute control by creator (instant death if disobedient)<li>Asexual, created and controlled</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li><!-- TODO: Add Demon class restrictions --></ul><hr>
                        <p><strong>Affinities:</strong> Killing, bloodshed, suffering, slaughter, mass-murder</p><hr>
                        <p><strong>Species:</strong> None (evolves through soul consumption)</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-sentient-beast">
                        <h3>Sentient Beast (Costs 2 Lives)</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Burst Damage: 7/10<li>Consistent Damage: 8/10<li>Defensive Capabilities: 8/10<li>Vitality: 7/10<li>Mobility: Depends/10<li>Utility: 7/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>2x rolled Health<li>2x SP gained from Realm<li>2x Qi Reserves (3x at MS+)<li>3x base Mental Fortitude<li>Bloodline Evolution system<li>Natural capabilities (claws, teeth, etc.)</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Limited by Bloodline Quality (Substandard to Ancient)<li>Harsh tribulations on breakthrough<li>Costs 2 Lives</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li><!-- TODO: Add Sentient Beast class restrictions --></ul><hr>
                        <p><strong>Species:</strong> Canine, Vulpine, Bovine, Ursine, Avian, Boar, Reptilian, Feline, Primate, Other Mammals</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-slimekin">
                        <h3>Slimekin</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 3/10<li>Speed: 4/10<li>Cultivation Speed: 6/10 (+10%)<li>Lifespan: 6/10 (+10%)<li>Durability: 9.5/10<li>Potential: 7.5/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Viscous Body - 3x Durability vs Physical attacks<li>Body of Fluid - Malleable form and shape<li>Integrated Sentient Race - Can assume Human form<li>Core with Qi Pathways (no standard anatomy)<li>Immune to all Poisons except Caustic, Mind, Soul<li>Above-average cultivation speed (+10%)</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Genderless, no reproduction<li>Water bodies can kill via dilution<li>Fatal weak point: Soul Core (apple-sized sphere)<li>Affected by extreme environments</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>All Martial Dao except BR<li>Elemental Dao (depends on variant, cannot use weakness)<li>Poison Dao<li>Psychic Dao<li>Zither</ul><hr>
                        <p><strong>Affinities:</strong> Varies by variant</p><hr>
                        <p><strong>Variants:</strong> Molten Slimekin, Glacial Slimekin, Regular Slimekin</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-solarian">
                        <h3>Solarian</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 7/10 (11/10 @ High Noon)<li>Speed: 3/10<li>Cultivation Speed: 7/10<li>Lifespan: 7/10 (+20%)<li>Durability: 7/10<li>Potential: 8.5/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Solar Strength - 2x power for 1 min during High Noon<li>One with the Sun - Enhanced senses during day<li>Solar Flare - Additional Yang Fire damage during day<li>Illumination of the Sun - 3x Mental Fortitude during High Noon<li>Solar Affinity - High affinity with Yang Fire and Fire Qi</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Weakened in darkness (halved damage dealt, doubled taken)<li>Not particularly fast</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>Yang Fire<li>Fire<li>All PWR Dao aside from BR<li>Buddhism (all branches)</ul><hr>
                        <p><strong>Affinities:</strong> Yang Fire, Fire, PWR Dao, Buddhism</p><hr>
                        <p><strong>Species:</strong> None</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-yokai">
                        <h3>Yokai</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: Depends/10<li>Speed: Depends/10<li>Cultivation Speed: 6/10 (+10%)<li>Lifespan: 8/10 (+30%)<li>Durability: Depends/10<li>Potential: 9/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Man-eaters of yore - Consume Humans to get stronger infinitely<li>Army of a Thousand Ghosts, Gods and Spirits - Wide variety available<li>Terror - Race-specific ability using fear to conceal presence<li>Above-average cultivation speed (+10%)<li>Mating season once a year</ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Develops bloodthirsty, malevolent aura from Human consumption<li>Eventual target of Righteous Cultivators and Factions</ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li>All Elemental Dao<li>All Martial Dao + Body Refiner</ul><hr>
                        <p><strong>Affinities:</strong> Varies by species</p><hr>
                        <p><strong>Species:</strong> Hososhi (Oni Minister), Karasu Tengu, Kejoro, Oni (Agility/Brutality/Spirituality), Kitsune (Fox Spirit), and many more</p>
                    </div>
                    
                    <div class="sheet-info-block sheet-info-winged-race">
                        <h3>Winged Race (Requires Foundation realm minimum)</h3>
                        <hr>
                        <p><strong>Parameters:</strong></p>
                        <ul><li>Strength: 3.5/10<li>Speed: 10/10<li>Cultivation Speed: 7/10 (+20%)<li>Lifespan: 7/10 (+20%)<li>Durability: 4/10<li>Potential: 8/10</ul><hr>
                        <p><strong>Features:</strong></p>
                        <ul><li>Innate Bloodline - Purity paramount<li>Fast cultivation speed (+20%)<li><!-- TODO: Add more Winged Race features --></ul><hr>
                        <p><strong>Negatives:</strong></p>
                        <ul><li>Requires Foundation realm minimum to play<li><!-- TODO: Add more Winged Race negatives --></ul><hr>
                        <p><strong>Class Restrictions:</strong></p>
                        <ul><li><!-- TODO: Add Winged Race class restrictions --></ul><hr>
                        <p><strong>Affinities:</strong> <!-- TODO: Add Winged Race affinities --></p><hr>
                        <p><strong>Species:</strong> <!-- TODO: Add Winged Race species --></p>
                    </div>
                    </div>
                </div>

                <div class="sheet-creation-buttons">
                    <button type="action" name="act_prev_step" class="sheet-btn-prev">Previous</button>
                    <button type="action" name="act_next_step" class="sheet-btn-next">Next</button>
                </div>
            </div>

            <!-- Step 2: Species Selection -->
            <div class="sheet-creation-step sheet-creation-species">
                <h2>Step 2: Choose Your Species</h2>
                
                <div class="sheet-species-content">
                    <!-- Species Radio Inputs (must be siblings of both selection and display) -->
                    <input type="radio" name="attr_species" value="demihuman_fox" id="demi-fox" class="sheet-hide">
                    <input type="radio" name="attr_species" value="demihuman_cat" id="demi-cat" class="sheet-hide">
                    <input type="radio" name="attr_species" value="demihuman_wolf" id="demi-wolf" class="sheet-hide">
                    <input type="radio" name="attr_species" value="demihuman_lion" id="demi-lion" class="sheet-hide">
                    <input type="radio" name="attr_species" value="demihuman_tiger" id="demi-tiger" class="sheet-hide">
                    <input type="radio" name="attr_species" value="demihuman_bear" id="demi-bear" class="sheet-hide">
                    
                    <input type="radio" name="attr_species" value="beastman_fox" id="beast-fox" class="sheet-hide">
                    <input type="radio" name="attr_species" value="beastman_cat" id="beast-cat" class="sheet-hide">
                    <input type="radio" name="attr_species" value="beastman_wolf" id="beast-wolf" class="sheet-hide">
                    <input type="radio" name="attr_species" value="beastman_lion" id="beast-lion" class="sheet-hide">
                    <input type="radio" name="attr_species" value="beastman_tiger" id="beast-tiger" class="sheet-hide">
                    <input type="radio" name="attr_species" value="beastman_bear" id="beast-bear" class="sheet-hide">
                    
                    <input type="radio" name="attr_species" value="blue_spirit_grass" id="plant-blue" class="sheet-hide">
                    <input type="radio" name="attr_species" value="red_spirit_grass" id="plant-red" class="sheet-hide">
                    <input type="radio" name="attr_species" value="ten_blade_lotus" id="plant-lotus" class="sheet-hide">
                    <input type="radio" name="attr_species" value="yang_flower" id="plant-yang" class="sheet-hide">
                    <input type="radio" name="attr_species" value="skullfruit" id="plant-skull" class="sheet-hide">
                    <input type="radio" name="attr_species" value="yin_vine" id="plant-yin" class="sheet-hide">
                    <input type="radio" name="attr_species" value="bloodthistle" id="plant-blood" class="sheet-hide">
                    <input type="radio" name="attr_species" value="venomleaf" id="plant-venom" class="sheet-hide">
                    <input type="radio" name="attr_species" value="ether_lily" id="plant-ether" class="sheet-hide">
                    <input type="radio" name="attr_species" value="starbloom" id="plant-star" class="sheet-hide">
                    <input type="radio" name="attr_species" value="golden_bamboo" id="plant-bamboo" class="sheet-hide">
                    
                    <input type="radio" name="attr_species" value="ant" id="crawl-ant" class="sheet-hide">
                    <input type="radio" name="attr_species" value="wasp" id="crawl-wasp" class="sheet-hide">
                    <input type="radio" name="attr_species" value="hornet" id="crawl-hornet" class="sheet-hide">
                    <input type="radio" name="attr_species" value="centipede" id="crawl-centipede" class="sheet-hide">
                    <input type="radio" name="attr_species" value="mantis" id="crawl-mantis" class="sheet-hide">
                    <input type="radio" name="attr_species" value="grasshopper" id="crawl-grasshopper" class="sheet-hide">
                    <input type="radio" name="attr_species" value="venomous_spider" id="crawl-venomous-spider" class="sheet-hide">
                    <input type="radio" name="attr_species" value="millipede" id="crawl-millipede" class="sheet-hide">
                    <input type="radio" name="attr_species" value="beetle" id="crawl-beetle" class="sheet-hide">
                    <input type="radio" name="attr_species" value="scorpion" id="crawl-scorpion" class="sheet-hide">
                    <input type="radio" name="attr_species" value="butterfly_moth" id="crawl-butterfly-moth" class="sheet-hide">
                    <input type="radio" name="attr_species" value="fleas" id="crawl-fleas" class="sheet-hide">
                    <input type="radio" name="attr_species" value="termite" id="crawl-termite" class="sheet-hide">
                    <input type="radio" name="attr_species" value="dragonfly" id="crawl-dragonfly" class="sheet-hide">
                    <input type="radio" name="attr_species" value="bee" id="crawl-bee" class="sheet-hide">
                    <input type="radio" name="attr_species" value="hunting_spider" id="crawl-hunting-spider" class="sheet-hide">
                    
                    <input type="radio" name="attr_species" value="imp" id="demon-imp" class="sheet-hide">
                    <input type="radio" name="attr_species" value="quasit" id="demon-quasit" class="sheet-hide">
                    <input type="radio" name="attr_species" value="aberration" id="demon-aberration" class="sheet-hide">
                    <input type="radio" name="attr_species" value="charger" id="demon-charger" class="sheet-hide">
                    
                    <input type="radio" name="attr_species" value="canine" id="beast-canine" class="sheet-hide">
                    <input type="radio" name="attr_species" value="vulpine" id="beast-vulpine" class="sheet-hide">
                    <input type="radio" name="attr_species" value="bovine" id="beast-bovine" class="sheet-hide">
                    <input type="radio" name="attr_species" value="ursine" id="beast-ursine" class="sheet-hide">
                    <input type="radio" name="attr_species" value="avian" id="beast-avian" class="sheet-hide">
                    <input type="radio" name="attr_species" value="boar" id="beast-boar" class="sheet-hide">
                    <input type="radio" name="attr_species" value="reptilian" id="beast-reptilian" class="sheet-hide">
                    <input type="radio" name="attr_species" value="feline" id="beast-feline" class="sheet-hide">
                    <input type="radio" name="attr_species" value="primate" id="beast-primate" class="sheet-hide">
                    <input type="radio" name="attr_species" value="other" id="beast-other" class="sheet-hide">
                    
                    <input type="radio" name="attr_species" value="molten" id="slime-molten" class="sheet-hide">
                    <input type="radio" name="attr_species" value="glacial" id="slime-glacial" class="sheet-hide">
                    <input type="radio" name="attr_species" value="regular" id="slime-regular" class="sheet-hide">
                    
                    <input type="radio" name="attr_species" value="hososhi" id="yokai-hososhi" class="sheet-hide">
                    <input type="radio" name="attr_species" value="karasu_tengu" id="yokai-karasu" class="sheet-hide">
                    <input type="radio" name="attr_species" value="kejoro" id="yokai-kejoro" class="sheet-hide">
                    <input type="radio" name="attr_species" value="oni_agility" id="yokai-oni-agi" class="sheet-hide">
                    <input type="radio" name="attr_species" value="oni_brutality" id="yokai-oni-brut" class="sheet-hide">
                    <input type="radio" name="attr_species" value="oni_spirituality" id="yokai-oni-spirit" class="sheet-hide">
                    <input type="radio" name="attr_species" value="kitsune" id="yokai-kitsune" class="sheet-hide">
                    <input type="radio" name="attr_species" value="wani" id="yokai-wani" class="sheet-hide">
                    <input type="radio" name="attr_species" value="kagutsuchi" id="yokai-kagutsuchi" class="sheet-hide">
                    
                    <!-- Left: Species Selection Grids -->
                    <div class="sheet-species-selection">
                        <!-- No Ancestry Selected -->
                        <div class="sheet-species-section sheet-species-none-selected">
                            <p class="sheet-info-message">Please select an ancestry in the previous step.</p>
                        </div>
                        
                        <!-- Human - No Species -->
                        <div class="sheet-species-section sheet-species-human">
                            <p class="sheet-info-message">Humans do not have species variations.</p>
                        </div>
                        
                        <!-- Demihuman Species -->
                        <div class="sheet-species-section sheet-species-demihuman">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Demihuman}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="demi-fox">Fox</label>
                                <label for="demi-cat">Cat</label>
                                <label for="demi-wolf">Wolf</label>
                                <label for="demi-lion">Lion</label>
                                <label for="demi-tiger">Tiger</label>
                                <label for="demi-bear">Bear</label>
                            </div>
                        </div>
                        
                        <!-- Beastman Species -->
                        <div class="sheet-species-section sheet-species-beastman">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Beastman}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="beast-fox">Fox</label>
                                <label for="beast-cat">Cat</label>
                                <label for="beast-wolf">Wolf</label>
                                <label for="beast-lion">Lion</label>
                                <label for="beast-tiger">Tiger</label>
                                <label for="beast-bear">Bear</label>
                            </div>
                        </div>
                
                <!-- Giant - No Species -->
                <div class="sheet-species-section sheet-species-giant">
                    <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Giant}} {{roll=[[1d10000]]}}">
                        Roll Bloodline Quality (1d10000)
                    </button>
                    <p class="sheet-info-message">Giants do not have species variations.</p>
                </div>
                
                <!-- Fishman - No Species -->
                <div class="sheet-species-section sheet-species-fishman">
                    <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Fishman}} {{roll=[[1d10000]]}}">
                        Roll Bloodline Quality (1d10000)
                    </button>
                    <p class="sheet-info-message">Fishmen do not have species variations (various sea beast descendants).</p>
                </div>
                        
                        <!-- Plantkin Origins -->
                        <div class="sheet-species-section sheet-species-plantkin">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Plantkin}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="plant-blue">Blue Spirit Grass</label>
                                <label for="plant-red">Red Spirit Grass</label>
                                <label for="plant-lotus">Ten Blade Lotus</label>
                                <label for="plant-yang">Yang Flower</label>
                                <label for="plant-skull">Skullfruit</label>
                                <label for="plant-yin">Yin Vine</label>
                                <label for="plant-blood">Bloodthistle</label>
                                <label for="plant-venom">Venomleaf</label>
                                <label for="plant-ether">Ether Lily</label>
                                <label for="plant-star">Starbloom</label>
                                <label for="plant-bamboo">Golden Bamboo</label>
                            </div>
                        </div>
                
                <!-- Lunarian - No Species -->
                <div class="sheet-species-section sheet-species-lunarian">
                    <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Lunarian}} {{roll=[[1d10000]]}}">
                        Roll Bloodline Quality (1d10000)
                    </button>
                    <p class="sheet-info-message">Lunarians do not have species variations.</p>
                </div>
                        
                        <!-- Crawler Archetypes -->
                        <div class="sheet-species-section sheet-species-crawler">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Crawler}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="crawl-ant">Ant</label>
                                <label for="crawl-wasp">Wasp</label>
                                <label for="crawl-hornet">Hornet</label>
                                <label for="crawl-centipede">Centipede</label>
                                <label for="crawl-mantis">Mantis</label>
                                <label for="crawl-grasshopper">Grasshopper</label>
                                <label for="crawl-venomous-spider">Venomous Spider</label>
                                <label for="crawl-millipede">Millipede</label>
                                <label for="crawl-beetle">Beetle</label>
                                <label for="crawl-scorpion">Scorpion</label>
                                <label for="crawl-butterfly-moth">Butterfly/Moth</label>
                                <label for="crawl-fleas">Fleas</label>
                                <label for="crawl-termite">Termite</label>
                                <label for="crawl-dragonfly">Dragonfly</label>
                                <label for="crawl-bee">Bee</label>
                                <label for="crawl-hunting-spider">Hunting Spider</label>
                            </div>
                        </div>
                        
                        <!-- Demon Evolutions -->
                        <div class="sheet-species-section sheet-species-demon">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Demon}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="demon-imp">Imp</label>
                                <label for="demon-quasit">Quasit</label>
                                <label for="demon-aberration">Aberration</label>
                                <label for="demon-charger">Charger</label>
                            </div>
                        </div>
                        
                        <!-- Sentient Beast Types -->
                        <div class="sheet-species-section sheet-species-sentient-beast">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Sentient Beast}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="beast-canine">Canine</label>
                                <label for="beast-vulpine">Vulpine</label>
                                <label for="beast-bovine">Bovine</label>
                                <label for="beast-ursine">Ursine</label>
                                <label for="beast-avian">Avian</label>
                                <label for="beast-boar">Boar</label>
                                <label for="beast-reptilian">Reptilian</label>
                                <label for="beast-feline">Feline</label>
                                <label for="beast-primate">Primate</label>
                                <label for="beast-other">Other</label>
                            </div>
                        </div>
                        
                        <!-- Slimekin Variants -->
                        <div class="sheet-species-section sheet-species-slimekin">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Slimekin}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="slime-molten">Molten</label>
                                <label for="slime-glacial">Glacial</label>
                                <label for="slime-regular">Regular</label>
                            </div>
                        </div>
                        
                        <!-- Solarian - No Species -->
                        <div class="sheet-species-section sheet-species-solarian">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Solarian}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            <p class="sheet-info-message">Solarians do not have species variations.</p>
                        </div>
                        
                        <!-- Yokai Types -->
                        <div class="sheet-species-section sheet-species-yokai">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Yokai}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            
                            <div class="sheet-species-grid">
                                <label for="yokai-hososhi">Hososhi</label>
                                <label for="yokai-karasu">Karasu Tengu</label>
                                <label for="yokai-kejoro">Kejoro</label>
                                <label for="yokai-oni-agi">Oni (Agility)</label>
                                <label for="yokai-oni-brut">Oni (Brutality)</label>
                                <label for="yokai-oni-spirit">Oni (Spirituality)</label>
                                <label for="yokai-kitsune">Kitsune</label>
                                <label for="yokai-wani">Wani</label>
                                <label for="yokai-kagutsuchi">Kagutsuchi</label>
                            </div>
                        </div>
                        
                        <!-- Winged Race - No Species Yet -->
                        <div class="sheet-species-section sheet-species-winged-race">
                            <button type="roll" name="roll_bloodline_quality" value="@{whisper}&{template:bloodline} {{name=@{character_name}}} {{ancestry=Winged Race}} {{roll=[[1d10000]]}}">
                                Roll Bloodline Quality (1d10000)
                            </button>
                            <p class="sheet-info-message">Winged Race species are not yet defined.</p>
                        </div>
                    </div>
                    
                    <!-- Right: Species Info Display -->
                    <div class="sheet-species-display">
                        <div class="sheet-species-info-placeholder">
                            <p class="sheet-info-message">Select a species to view details</p>
                        </div>
                        
                        <!-- Demihuman Species Info -->
                        <div class="sheet-species-info sheet-species-info-demi-fox">
                            <h3>Fox (Demihuman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-demi-cat">
                            <h3>Cat (Demihuman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-demi-wolf">
                            <h3>Wolf (Demihuman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-demi-lion">
                            <h3>Lion (Demihuman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-demi-tiger">
                            <h3>Tiger (Demihuman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-demi-bear">
                            <h3>Bear (Demihuman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        
                        <!-- Beastman Species Info -->
                        <div class="sheet-species-info sheet-species-info-beast-fox">
                            <h3>Fox (Beastman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-beast-cat">
                            <h3>Cat (Beastman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-beast-wolf">
                            <h3>Wolf (Beastman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-beast-lion">
                            <h3>Lion (Beastman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-beast-tiger">
                            <h3>Tiger (Beastman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        <div class="sheet-species-info sheet-species-info-beast-bear">
                            <h3>Bear (Beastman)</h3>
                            <p><em>WIP - Species details pending</em></p><hr>
                        <p><strong>Bloodline Quality Bonuses:</strong></p>
                            <ul><li><strong>Substandard (1-2000):</strong> WIP<li><strong>Basic (2001-4000):</strong> WIP<li><strong>Intermediate (4001-7000):</strong> WIP<li><strong>Advanced (7001-9000):</strong> WIP<li><strong>Ancient (9001-10000):</strong> WIP</ul>
                        </div>
                        
                        <!-- Plantkin Species Info -->
                        <div class="sheet-species-info sheet-species-info-plant-blue"><h3>Blue Spirit Grass</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-red"><h3>Red Spirit Grass</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-lotus"><h3>Ten Blade Lotus</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-yang"><h3>Yang Flower</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-skull"><h3>Skullfruit</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-yin"><h3>Yin Vine</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-blood"><h3>Bloodthistle</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-venom"><h3>Venomleaf</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-ether"><h3>Ether Lily</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-star"><h3>Starbloom</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-plant-bamboo"><h3>Golden Bamboo</h3><p><em>WIP</em></p></div>
                        
                        <!-- Crawler Species Info -->
                        <div class="sheet-species-info sheet-species-info-crawl-ant"><h3>Ant</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-wasp"><h3>Wasp</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-hornet"><h3>Hornet</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-centipede"><h3>Centipede</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-mantis"><h3>Mantis</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-grasshopper"><h3>Grasshopper</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-venomous-spider"><h3>Venomous Spider</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-millipede"><h3>Millipede</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-beetle"><h3>Beetle</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-scorpion"><h3>Scorpion</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-butterfly-moth"><h3>Butterfly/Moth</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-fleas"><h3>Fleas</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-termite"><h3>Termite</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-dragonfly"><h3>Dragonfly</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-bee"><h3>Bee</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-crawl-hunting-spider"><h3>Hunting Spider</h3><p><em>WIP</em></p></div>
                        
                        <!-- Demon Species Info -->
                        <div class="sheet-species-info sheet-species-info-demon-imp"><h3>Imp</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-demon-quasit"><h3>Quasit</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-demon-aberration"><h3>Aberration</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-demon-charger"><h3>Charger</h3><p><em>WIP</em></p></div>
                        
                        <!-- Sentient Beast Species Info -->
                        <div class="sheet-species-info sheet-species-info-beast-canine"><h3>Canine</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-vulpine"><h3>Vulpine</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-bovine"><h3>Bovine</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-ursine"><h3>Ursine</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-avian"><h3>Avian</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-boar"><h3>Boar</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-reptilian"><h3>Reptilian</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-feline"><h3>Feline</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-primate"><h3>Primate</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-beast-other"><h3>Other</h3><p><em>WIP</em></p></div>
                        
                        <!-- Slimekin Species Info -->
                        <div class="sheet-species-info sheet-species-info-slime-molten"><h3>Molten</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-slime-glacial"><h3>Glacial</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-slime-regular"><h3>Regular</h3><p><em>WIP</em></p></div>
                        
                        <!-- Yokai Species Info -->
                        <div class="sheet-species-info sheet-species-info-yokai-hososhi"><h3>Hososhi</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-karasu"><h3>Karasu Tengu</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-kejoro"><h3>Kejoro</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-oni-agi"><h3>Oni (Agility)</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-oni-brut"><h3>Oni (Brutality)</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-oni-spirit"><h3>Oni (Spirituality)</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-kitsune"><h3>Kitsune</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-wani"><h3>Wani</h3><p><em>WIP</em></p></div>
                        <div class="sheet-species-info sheet-species-info-yokai-kagutsuchi"><h3>Kagutsuchi</h3><p><em>WIP</em></p></div>
                        
                        <!-- Human/Giant/Fishman/Lunarian/Solarian/Winged Race Info -->
                        <div class="sheet-species-info sheet-species-info-human">
                            <p class="sheet-info-message">Humans do not have species variations.</p>
                        </div>
                        <div class="sheet-species-info sheet-species-info-giant">
                            <p class="sheet-info-message">Giants do not have species variations.</p>
                        </div>
                        <div class="sheet-species-info sheet-species-info-fishman">
                            <p class="sheet-info-message">Fishmen do not have species variations.</p>
                        </div>
                        <div class="sheet-species-info sheet-species-info-lunarian">
                            <p class="sheet-info-message">Lunarians do not have species variations.</p>
                        </div>
                        <div class="sheet-species-info sheet-species-info-solarian">
                            <p class="sheet-info-message">Solarians do not have species variations.</p>
                        </div>
                        <div class="sheet-species-info sheet-species-info-winged-race">
                            <p class="sheet-info-message">Winged Race species are not yet defined.</p>
                        </div>
                    </div>
                </div>

                <div class="sheet-creation-buttons">
                    <button type="action" name="act_prev_step" class="sheet-btn-prev">Previous</button>
                    <button type="action" name="act_next_step" class="sheet-btn-next">Next</button>
                </div>
            </div>

            <!-- Step 3: Path Selection -->
            <div class="sheet-creation-step sheet-creation-path">
                <h2>Step 3: Choose Your Path</h2>
                
                <div class="sheet-path-tabs">
                    <label for="path-mortal">Mortal</label>
                    <label for="path-cultivator">Cultivator</label>
                </div>
                
                <div class="sheet-path-content sheet-path-mortal">
                    <h3>Mortal Path</h3>
                    <p>Mortals progress through levels, gaining strength through training and experience.</p>
                    <label>Mortal Level:</label>
                    <select name="attr_mortal_level">
                        <option value="0">0 - Commoner/Civilian</option>
                        <option value="1">1 - Amateur</option>
                        <option value="2">2 - Novice Brawler</option>
                        <option value="3">3 - Adept Brawler</option>
                        <option value="4">4 - Expert Brawler</option>
                        <option value="5">5 - Novice Warrior/Soldier</option>
                        <option value="6">6 - Adept Warrior/Soldier</option>
                        <option value="7">7 - Veteran Warrior/Soldier</option>
                        <option value="8">8 - Expert Warrior/Soldier</option>
                        <option value="9">9 - Amateur Martial Artist</option>
                        <option value="10">10 - Novice Martial Artist</option>
                        <option value="11">11 - Martial Artist</option>
                        <option value="12">12 - Experienced Martial Artist</option>
                        <option value="13">13 - Veteran Martial Artist</option>
                        <option value="14">14 - Master Martial Artist</option>
                        <option value="15">15 - Half-Step Grandmaster</option>
                        <option value="16">16 - Grandmaster</option>
                        <option value="17">17 - Peak Grandmaster</option>
                        <option value="18">18 - Supreme Grandmaster</option>
                        <option value="19">19 - Heavenly Grandmaster</option>
                        <option value="20">20 - Transcendent Grandmaster</option>
                    </select>
                </div>
                
                <div class="sheet-path-content sheet-path-cultivator">
                    <h3>Cultivator Path</h3>
                    <p>Cultivators progress through Major and Minor Realms, absorbing Qi to strengthen themselves.</p>
                    <label>Major Realm:</label>
                    <select name="attr_major_realm">
                        <option value="qi_gathering">Qi Gathering</option>
                        <option value="foundation">Foundation</option>
                        <option value="core_formation">Core Formation</option>
                        <option value="martial_soul">Martial Soul</option>
                        <option value="god_ascendance">God Ascendance</option>
                    </select>
                    <label>Minor Realm:</label>
                    <select name="attr_minor_realm">
                        <option value="early">Early</option>
                        <option value="mid">Mid</option>
                        <option value="late">Late</option>
                        <option value="peak">Peak</option>
                    </select>
                </div>
                
                <div class="sheet-creation-buttons">
                    <button type="action" name="act_prev_step" class="sheet-btn-prev">Previous</button>
                    <button type="action" name="act_next_step" class="sheet-btn-next">Next</button>
                </div>
            </div>

            <!-- Step 4: Dao Selection -->
            <div class="sheet-creation-step sheet-creation-dao">
                <h2>Step 4: Choose Your Dao</h2>
                
                <div class="sheet-dao-mortal-msg">
                    <p style="text-align: center; font-size: 16px; padding: 40px; color: #8b6914;">
                        <strong>Dao paths are only available to Cultivators.</strong><br>
                        Mortals do not follow a Dao path.
                    </p>
                </div>
                
                <div class="sheet-dao-cultivator-content">
                    <!-- Dao Radio Buttons -->
                    <input type="radio" name="attr_dao_path" value="sword" id="dao-sword" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="spear" id="dao-spear" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="body_refiner" id="dao-body-refiner" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="corpse" id="dao-corpse" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="puppet" id="dao-puppet" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="psychic" id="dao-psychic" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="zither" id="dao-zither" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="guqin" id="dao-guqin" class="sheet-hide">
                    <input type="radio" name="attr_dao_path" value="ghost" id="dao-ghost" class="sheet-hide">
                    
                    <div class="sheet-dao-tabs">
                        <label for="dao-sword">Sword</label>
                        <label for="dao-spear">Spear</label>
                        <label for="dao-body-refiner">Body Refiner</label>
                        <label for="dao-corpse">Corpse</label>
                        <label for="dao-puppet">Puppet</label>
                        <label for="dao-psychic">Psychic</label>
                        <label for="dao-zither">Zither</label>
                        <label for="dao-guqin">Guqin</label>
                        <label for="dao-ghost">Ghost</label>
                    </div>
                    
                    <div class="sheet-creation-layout">
                        <!-- Sword Dao -->
                        <div class="sheet-dao-selection sheet-dao-sword">
                            <h3>Sword Dao</h3>
                            <p>Choose your sword style:</p>
                            <label><input type="radio" name="attr_dao_subpath" value="twin_dragon"><span>Twin Dragon (Agility)</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="silent_draw"><span>Silent Draw (Power)</span></label>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-sword-info">
                            <h4>Sword Dao</h4>
                            <p><strong>Type:</strong> Martial</p>
                            <p><strong>Twin Dragon:</strong> Dual wield style focused on consistent damage and mobility. Main Stat: Agility. Health: 1d10+5+CON.</p>
                            <p><strong>Silent Draw:</strong> One-handed style with devastating burst damage. Main Stat: Power. Health: 1d14+7+CON.</p>
                            <p><strong>Daobility:</strong> Twin Dragon gains damage reduction responses. Silent Draw unleashes powerful sheathed attacks.</p>
                        </div>
                        
                        <!-- Spear Dao -->
                        <div class="sheet-dao-selection sheet-dao-spear">
                            <h3>Spear Dao</h3>
                            <p>No sub-paths available.</p>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-spear-info">
                            <h4>Spear Dao</h4>
                            <p><strong>Type:</strong> Martial | <strong>Main Stat:</strong> Power</p>
                            <p><strong>Health:</strong> 1d15+8+VIT</p>
                            <p><strong>Range:</strong> 10-15m melee range</p>
                            <p><strong>Strengths:</strong> Highest accuracy and attack effectiveness. Counter to tangible projectiles.</p>
                            <p><strong>Daobility:</strong> Long Weapon Spinning - Tangible ranged attacks have -20% accuracy (-50% with Evasive Stance).</p>
                        </div>
                        
                        <!-- Body Refiner -->
                        <div class="sheet-dao-selection sheet-dao-body-refiner">
                            <h3>Body Refiner</h3>
                            <p>Choose your refinement path:</p>
                            <label><input type="radio" name="attr_dao_subpath" value="fist"><span>Fist (Power)</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="kick"><span>Kick (Power+Agility)</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="finger"><span>Finger (Agility)</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="palm"><span>Palm (Vitality)</span></label>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-body-refiner-info">
                            <h4>Body Refiner</h4>
                            <p><strong>Type:</strong> Martial | <strong>Health:</strong> 1d20+10+VIT</p>
                            <p><strong>Fist (Power):</strong> Powerful strikes, excellent at breaking objects, shields, and barriers.</p>
                            <p><strong>Kick (Power+Agility):</strong> Longer reach than fists, always hits first in counters against bare-handed opponents.</p>
                            <p><strong>Finger (Agility):</strong> Speed-based refiner, most evasive but least durable.</p>
                            <p><strong>Palm (Vitality):</strong> Immortality refiner focused on durability and longevity.</p>
                        </div>
                        
                        <!-- Corpse Dao -->
                        <div class="sheet-dao-selection sheet-dao-corpse">
                            <h3>Corpse Dao</h3>
                            <p>No sub-paths available.</p>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-corpse-info">
                            <h4>Corpse Dao</h4>
                            <p><strong>Type:</strong> Summoner | <strong>Main Stat:</strong> Mental Strength</p>
                            <p>Control and command corpses in battle. Raise the dead to fight for you.</p>
                            <p><strong>Max Corpses:</strong> Mental Strength / 5 (rounded down)</p>
                            <p><strong>Control:</strong> Max corpse stats = 150% of your stats</p>
                        </div>
                        
                        <!-- Puppet Dao -->
                        <div class="sheet-dao-selection sheet-dao-puppet">
                            <h3>Puppet Dao</h3>
                            <p>No sub-paths available.</p>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-puppet-info">
                            <h4>Puppet Dao</h4>
                            <p><strong>Type:</strong> Summoner | <strong>Main Stat:</strong> Mental Strength</p>
                            <p>Craft and control puppets. Create Forged Puppets with Spark of Life.</p>
                            <p><strong>Strengths:</strong> Puppets can survive inhospitable conditions and withstand attacks that would destroy flesh.</p>
                            <p><strong>Investment:</strong> Requires materials and time to craft powerful puppets.</p>
                        </div>
                        
                        <!-- Psychic Dao -->
                        <div class="sheet-dao-selection sheet-dao-psychic">
                            <h3>Psychic Dao</h3>
                            <p>No sub-paths available.</p>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-psychic-info">
                            <h4>Psychic Dao</h4>
                            <p><strong>Type:</strong> Martial | <strong>Main Stat:</strong> Mental Strength</p>
                            <p>Control specially-forged Flying Weapons via telekinesis.</p>
                            <p><strong>Control Range:</strong> Send weapons anywhere within radius to attack or defend.</p>
                            <p><strong>Trade-off:</strong> More weapons controlled = smaller control range.</p>
                        </div>
                        
                        <!-- Zither Dao -->
                        <div class="sheet-dao-selection sheet-dao-zither">
                            <h3>Zither Dao</h3>
                            <p>Choose your element:</p>
                            <label><input type="radio" name="attr_dao_subpath" value="metal"><span>Metal</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="wood"><span>Wood</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="fire"><span>Fire</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="earth"><span>Earth</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="water"><span>Water</span></label>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-zither-info">
                            <h4>Zither Dao</h4>
                            <p><strong>Type:</strong> Elemental | <strong>Main Stat:</strong> Qi Control</p>
                            <p>Channel elemental power through musical cultivation.</p>
                            <p>Choose from five elements: Metal, Wood, Fire, Earth, or Water.</p>
                            <p>Each element provides unique techniques and abilities.</p>
                        </div>
                        
                        <!-- Guqin Dao -->
                        <div class="sheet-dao-selection sheet-dao-guqin">
                            <h3>Guqin Dao</h3>
                            <p>No sub-paths available.</p>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-guqin-info">
                            <h4>Guqin Dao</h4>
                            <p><strong>Type:</strong> Support | <strong>Main Stat:</strong> Mental Strength</p>
                            <p>Musical cultivation focused on support and control.</p>
                            <p>Provides buffs, debuffs, and battlefield control through music.</p>
                        </div>
                        
                        <!-- Ghost Dao -->
                        <div class="sheet-dao-selection sheet-dao-ghost">
                            <h3>Ghost Dao</h3>
                            <p>Choose your ghost type:</p>
                            <label><input type="radio" name="attr_dao_subpath" value="vengeful"><span>Vengeful Ghost (Agility)</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="elusive"><span>Elusive Spectre (Agility)</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="vanishing"><span>Vanishing Wraith (Agility)</span></label>
                            <label><input type="radio" name="attr_dao_subpath" value="soul_scholar"><span>Soul Scholar (Mental)</span></label>
                        </div>
                        
                        <div class="sheet-dao-info sheet-dao-ghost-info">
                            <h4>Ghost Dao</h4>
                            <p><strong>Type:</strong> Spectral</p>
                            <p><strong>Agility Ghosts:</strong> Vengeful, Elusive, and Vanishing focus on speed and evasion.</p>
                            <p><strong>Soul Scholar:</strong> Mental Strength-based path focused on spiritual power.</p>
                            <p>Ghost cultivators walk the line between life and death.</p>
                        </div>
                    </div>
                </div>
                
                <div class="sheet-creation-buttons">
                    <button type="action" name="act_prev_step" class="sheet-btn-prev">Previous</button>
                    <button type="action" name="act_next_step" class="sheet-btn-next">Next</button>
                </div>
            </div>

            <!-- Step 5: Stats Assignment -->
            <div class="sheet-creation-step sheet-creation-stats">
                <h2>Step 5: Assign Your Stats</h2>
                
                <!-- Sub-step tabs -->
                <div class="sheet-stats-tabs">
                    <button type="action" name="act_stats_starting" class="sheet-stats-tab">Starting Stats</button>
                    <button type="action" name="act_stats_realm" class="sheet-stats-tab">Realm Allocation</button>
                    <button type="action" name="act_stats_finalize" class="sheet-stats-tab">Finalize</button>
                </div>
                
                <!-- Starting Stats Sub-step -->
                <div class="sheet-stats-substep sheet-stats-starting">
                    <div class="sheet-stats-layout">
                        <div class="sheet-stats-choice">
                            <h3>Starting Stats</h3>
                            <p>Assign values to your six stats:</p>
                            
                            <div class="sheet-stat-inputs">
                                <label>Power: <input type="number" name="attr_power_start" value="1" min="1" max="3"></label>
                                <label>Agility: <input type="number" name="attr_agility_start" value="1" min="1" max="3"></label>
                                <label>Vitality: <input type="number" name="attr_vitality_start" value="1" min="1" max="3"></label>
                                <label>Mental: <input type="number" name="attr_mental_start" value="1" min="1" max="3"></label>
                                <label>Qi Control: <input type="number" name="attr_qicontrol_start" value="1" min="1" max="3"></label>
                                <label>Cult Speed: <input type="number" name="attr_cultspeed_start" value="1" min="1" max="3"></label>
                            </div>
                        </div>
                        
                        <div class="sheet-stats-info">
                            <h4>Standard Array</h4>
                            <p>Use: 1, 1, 2, 2, 3, 3</p>
                            <p>Each value used exactly twice</p>
                            <hr>
                            <h4>Manual Entry</h4>
                            <p>Enter your rolled or custom values</p>
                        </div>
                    </div>
                </div>
                
                <!-- Realm Allocation Sub-step -->
                <div class="sheet-stats-substep sheet-stats-realm">
                    <div class="sheet-stats-layout">
                        <div class="sheet-stats-choice">
                            <h3>Realm/Level Allocation</h3>
                            <p><strong>Available Points:</strong> <span name="attr_realm_points">0</span></p>
                            
                            <div class="sheet-stat-inputs">
                                <label>Power: <input type="number" name="attr_power_realm" value="0" min="0"></label>
                                <label>Agility: <input type="number" name="attr_agility_realm" value="0" min="0"></label>
                                <label>Vitality: <input type="number" name="attr_vitality_realm" value="0" min="0"></label>
                                <label>Mental: <input type="number" name="attr_mental_realm" value="0" min="0"></label>
                                <label>Qi Control: <input type="number" name="attr_qicontrol_realm" value="0" min="0"></label>
                                <label>Cult Speed: <input type="number" name="attr_cultspeed_realm" value="0" min="0"></label>
                            </div>
                            
                            <p><strong>Spent:</strong> <span name="attr_realm_spent">0</span> / <span name="attr_realm_points">0</span></p>
                        </div>
                        
                        <div class="sheet-stats-info">
                            <h4>Point Calculation</h4>
                            <p><strong>Mortal:</strong> Level  2</p>
                            <p><strong>Cultivator:</strong> Realm z value</p>
                            <hr>
                            <p><strong>Your Path:</strong> <span name="attr_path_display">-</span></p>
                            <p><strong>Your Level:</strong> <span name="attr_level_display">-</span></p>
                        </div>
                    </div>
                </div>
                
                <!-- Finalize Sub-step -->
                <div class="sheet-stats-substep sheet-stats-finalize">
                    <div class="sheet-stats-layout">
                        <div class="sheet-stats-choice">
                            <h3>Final Stats</h3>
                            <div class="sheet-final-stats">
                                <div><strong>Power:</strong> <span name="attr_power_final">1</span></div>
                                <div><strong>Agility:</strong> <span name="attr_agility_final">1</span></div>
                                <div><strong>Vitality:</strong> <span name="attr_vitality_final">1</span></div>
                                <div><strong>Mental:</strong> <span name="attr_mental_final">1</span></div>
                                <div><strong>Qi Control:</strong> <span name="attr_qicontrol_final">1</span></div>
                                <div><strong>Cult Speed:</strong> <span name="attr_cultspeed_final">1</span></div>
                            </div>
                        </div>
                        
                        <div class="sheet-stats-info">
                            <h4>Milestones</h4>
                            <div class="sheet-milestones">
                                <p><strong>PWR:</strong> <span name="attr_power_milestones">-</span></p>
                                <p><strong>AGI:</strong> <span name="attr_agility_milestones">-</span></p>
                                <p><strong>VIT:</strong> <span name="attr_vitality_milestones">-</span></p>
                                <p><strong>MTL:</strong> <span name="attr_mental_milestones">-</span></p>
                                <p><strong>QIC:</strong> <span name="attr_qicontrol_milestones">-</span></p>
                                <p><strong>CUL:</strong> <span name="attr_cultspeed_milestones">-</span></p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="sheet-creation-buttons">
                    <button type="action" name="act_prev_step" class="sheet-btn-prev">Previous</button>
                    <button type="action" name="act_next_step" class="sheet-btn-next">Next</button>
                </div>
            </div>

            <!-- Completion -->
            <div class="sheet-creation-step sheet-creation-complete">
                <h2>Character Creation Complete</h2>
                <p>Your character has been created successfully!</p>
                <button type="action" name="act_complete_char_creation" class="sheet-done-button">DONE</button>
            </div>
        </div>

        <!-- Mortal Page -->
        <div class="sheet-page sheet-page-mortal">
            <h2>Mortal Character</h2>
            <p>Mortal character stats and information.</p>
        </div>

        <!-- Cultivator Page -->
        <div class="sheet-page sheet-page-cultivator">
            <h2>Cultivator Character</h2>
            <p>Cultivator character stats and information.</p>
        </div>

        <!-- Beast Page -->
        <div class="sheet-page sheet-page-beast">
            <h2>Beast Character</h2>
            <p>Beast character stats and information.</p>
        </div>

        <!-- Combat Page -->
        <div class="sheet-page sheet-page-combat">
            <h2>Combat</h2>
            <p>Combat stats and actions.</p>
        </div>

        <!-- Techniques Page -->
        <div class="sheet-page sheet-page-techniques">
            <h2>Techniques</h2>
            <p>Character techniques and abilities.</p>
        </div>

        <!-- Bio Page -->
        <div class="sheet-page sheet-page-bio">
            <h2>Biography</h2>
            <textarea name="attr_biography" placeholder="Character biography..."></textarea>
        </div>

        <!-- Notes Page -->
        <div class="sheet-page sheet-page-notes">
            <h2>Notes</h2>
            <textarea name="attr_notes" placeholder="Character notes..."></textarea>
        </div>

        <!-- Inventory Page -->
        <div class="sheet-page sheet-page-inventory">
            <h2>Inventory</h2>
            <p>Character inventory and equipment.</p>
        </div>

        <!-- Options Page -->
        <div class="sheet-page sheet-page-options">
            <h2>Options</h2>
            <div class="sheet-options-content">
                <div class="sheet-option">
                    <label>
                        <input type="checkbox" name="attr_is_beast" value="1">
                        <span>Beast Character Mode</span>
                    </label>
                </div>
                <div class="sheet-option">
                    <button type="action" name="act_level_realm_up">Level Up / Realm Up</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Roll Templates -->
<rolltemplate class="sheet-rolltemplate-bloodline">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <span class="sheet-template-title">Bloodline Quality Roll</span>
        </div>
        <div class="sheet-template-body">
            {{#name}}
            <div class="sheet-template-row">
                <span class="sheet-template-label">Character:</span>
                <span class="sheet-template-value">{{name}}</span>
            </div>
            {{/name}}
            {{#ancestry}}
            <div class="sheet-template-row">
                <span class="sheet-template-label">Ancestry:</span>
                <span class="sheet-template-value">{{ancestry}}</span>
            </div>
            {{/ancestry}}
            {{#species}}
            <div class="sheet-template-row">
                <span class="sheet-template-label">Species:</span>
                <span class="sheet-template-value">{{species}}</span>
            </div>
            {{/species}}
            {{#roll}}
            <div class="sheet-template-row sheet-template-main-roll">
                <span class="sheet-template-label">Roll Result:</span>
                <span class="sheet-template-roll">{{roll}}</span>
            </div>
            {{/roll}}
        </div>
    </div>
</rolltemplate>

<rolltemplate class="sheet-rolltemplate-statsroll">
    <div class="sheet-template-container">
        <div class="sheet-template-header">
            <span class="sheet-template-title">Stat Rolls</span>
        </div>
        <div class="sheet-template-body">
            {{#character}}
            <div class="sheet-template-row">
                <span class="sheet-template-label">Character:</span>
                <span class="sheet-template-value">{{character}}</span>
            </div>
            {{/character}}
            <div class="sheet-stats-roll-table">
                <div class="sheet-stat-roll-cell">
                    <div class="sheet-stat-roll-label">PWR</div>
                    <div class="sheet-stat-roll-value">{{pwr}}</div>
                </div>
                <div class="sheet-stat-roll-cell">
                    <div class="sheet-stat-roll-label">AGI</div>
                    <div class="sheet-stat-roll-value">{{agi}}</div>
                </div>
                <div class="sheet-stat-roll-cell">
                    <div class="sheet-stat-roll-label">VIT</div>
                    <div class="sheet-stat-roll-value">{{vit}}</div>
                </div>
                <div class="sheet-stat-roll-cell">
                    <div class="sheet-stat-roll-label">MTL</div>
                    <div class="sheet-stat-roll-value">{{mtl}}</div>
                </div>
                <div class="sheet-stat-roll-cell">
                    <div class="sheet-stat-roll-label">QIC</div>
                    <div class="sheet-stat-roll-value">{{qic}}</div>
                </div>
                <div class="sheet-stat-roll-cell">
                    <div class="sheet-stat-roll-label">CUL</div>
                    <div class="sheet-stat-roll-value">{{cul}}</div>
                </div>
            </div>
        </div>
    </div>
</rolltemplate>

<!-- Sheet Workers -->
<script type="text/worker">
// ========================================
// CENTRALIZED GAME DATA
// ========================================
var GAME_DATA = {
    ancestries: {
        human: {
            cultivation: 30,
            lifespan: -25,
            hasSpecies: false,
            hasBloodline: false
        },
        demihuman: {
            cultivation: 10,
            lifespan: -10,
            hasSpecies: true,
            hasBloodline: true,
            species: ["demihuman_fox", "demihuman_cat", "demihuman_wolf", "demihuman_lion", "demihuman_tiger", "demihuman_bear"]
        },
        beastman: {
            cultivation: -10,
            lifespan: 30,
            hasSpecies: true,
            hasBloodline: true,
            species: ["beastman_fox", "beastman_cat", "beastman_wolf", "beastman_lion", "beastman_tiger", "beastman_bear"]
        },
        giant: {
            cultivation: 10,
            lifespan: 50,
            hasSpecies: false,
            hasBloodline: true
        },
        fishman: {
            cultivation: 0,
            lifespan: 0,
            hasSpecies: false,
            hasBloodline: true
        },
        plantkin: {
            cultivation: 10,
            lifespan: 40,
            hasSpecies: true,
            hasBloodline: true,
            species: ["blue_spirit_grass", "red_spirit_grass", "ten_blade_lotus", "yang_flower", "skullfruit", "yin_vine", "bloodthistle", "venomleaf", "ether_lily", "starbloom", "golden_bamboo"]
        },
        lunarian: {
            cultivation: 30,
            lifespan: 30,
            hasSpecies: false,
            hasBloodline: true
        },
        crawler: {
            cultivation: 30,
            lifespan: -15,
            hasSpecies: true,
            hasBloodline: true,
            species: ["ant", "wasp", "hornet", "centipede", "mantis", "grasshopper", "venomous_spider", "millipede", "beetle", "scorpion", "butterfly_moth", "fleas", "termite", "dragonfly", "bee", "hunting_spider"]
        },
        demon: {
            cultivation: 0,
            lifespan: 50,
            hasSpecies: true,
            hasBloodline: true,
            species: ["imp", "quasit", "aberration", "charger"]
        },
        sentient_beast: {
            cultivation: 0,
            lifespan: 0,
            hasSpecies: true,
            hasBloodline: true,
            species: ["canine", "vulpine", "bovine", "ursine", "avian", "boar", "reptilian", "feline", "primate", "other"]
        },
        slimekin: {
            cultivation: 10,
            lifespan: 10,
            hasSpecies: true,
            hasBloodline: true,
            species: ["molten", "glacial", "regular"]
        },
        solarian: {
            cultivation: 30,
            lifespan: 30,
            hasSpecies: false,
            hasBloodline: true
        },
        yokai: {
            cultivation: 10,
            lifespan: 30,
            hasSpecies: true,
            hasBloodline: true,
            species: ["hososhi", "karasu_tengu", "kejoro", "oni_agility", "oni_brutality", "oni_spirituality", "kitsune", "wani", "kagutsuchi"]
        },
        winged_race: {
            cultivation: 30,
            lifespan: 30,
            hasSpecies: false,
            hasBloodline: true
        }
    }
};

// Helper functions
function getAncestryData(key) {
    return GAME_DATA.ancestries[key] || null;
}

function getSpeciesForAncestry(key) {
    var ancestry = GAME_DATA.ancestries[key];
    return (ancestry && ancestry.species) ? ancestry.species : [];
}

// Legacy compatibility
var ancestryModifiers = {};
for (var key in GAME_DATA.ancestries) {
    ancestryModifiers[key] = {
        cultivation: GAME_DATA.ancestries[key].cultivation,
        lifespan: GAME_DATA.ancestries[key].lifespan
    };
}

// Initialize sheet on first open
on("sheet:opened", function() {
    getAttrs(["show_char_creation", "character_type", "is_beast", "creation_step"], function(values) {
        if (!values.show_char_creation || values.show_char_creation === "1") {
            setAttrs({ 
                page: "char_creation",
                creation_step: values.creation_step || "0"
            });
        } else {
            if (values.is_beast === "1") {
                setAttrs({ page: "beast" });
            } else if (values.character_type === "cultivator") {
                setAttrs({ page: "cultivator" });
            } else {
                setAttrs({ page: "mortal" });
            }
        }
    });
});

// Handle step tab clicks
on("clicked:step_tab_0", function() {
    setAttrs({ creation_step: "0" });
});

on("clicked:step_tab_1", function() {
    setAttrs({ creation_step: "1" });
});

on("clicked:step_tab_2", function() {
    setAttrs({ creation_step: "2" });
});

on("clicked:step_tab_3", function() {
    setAttrs({ creation_step: "3" });
});

on("clicked:step_tab_4", function() {
    setAttrs({ creation_step: "4" });
});

on("clicked:step_tab_5", function() {
    setAttrs({ creation_step: "5" });
});

on("clicked:step_tab_complete", function() {
    setAttrs({ creation_step: "complete" });
});

// Handle Next button
on("clicked:next_step", function() {
    getAttrs(["creation_step"], function(values) {
        var currentStep = parseInt(values.creation_step) || 0;
        var nextStep = currentStep === 5 ? "complete" : (currentStep + 1).toString();
        setAttrs({ creation_step: nextStep });
    });
});

// Handle Previous button
on("clicked:prev_step", function() {
    getAttrs(["creation_step"], function(values) {
        var currentStep = values.creation_step === "complete" ? 5 : (parseInt(values.creation_step) || 0);
        var prevStep = Math.max(0, currentStep - 1).toString();
        setAttrs({ creation_step: prevStep });
    });
});

// Handle path type changes - reset level/realm
on("change:path_type", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    setAttrs({
        mortal_level: "0",
        major_realm: "qi_gathering",
        minor_realm: "early",
        dao_path: "",
        dao_subpath: ""
    });
});

// Handle major realm changes - reset minor realm to early
on("change:major_realm", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    setAttrs({ minor_realm: "early" });
});

// Handle dao_path changes - reset subpath
on("change:dao_path", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    setAttrs({ dao_subpath: "" });
});

// Stats Step Handlers

// Starting stats tracking (no calculation needed - just manual entry)
on("change:power_start change:agility_start change:vitality_start change:mental_start change:qicontrol_start change:cultspeed_start", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    // No validation - allow any values for manual/standard array
});

// Realm points calculation
on("change:path_type change:mortal_level change:major_realm change:minor_realm sheet:opened", function(eventInfo) {
    if (eventInfo && eventInfo.sourceType === "sheetworker") return;
    
    getAttrs(["path_type", "mortal_level", "major_realm", "minor_realm"], function(v) {
        var points = 0;
        var pathDisplay = v.path_type === "mortal" ? "Mortal" : "Cultivator";
        var levelDisplay = "";
        
        if (v.path_type === "mortal") {
            var level = parseInt(v.mortal_level) || 0;
            points = level * 2;
            levelDisplay = "Level " + level;
        } else {
            var realmPoints = {
                qi_gathering: { early: 1, mid: 2, late: 3, peak: 5 },
                foundation: { early: 9, mid: 13, late: 19, peak: 25 },
                core_formation: { early: 36, mid: 50, late: 67, peak: 87 },
                martial_soul: { early: 130, mid: 174, late: 260, peak: 347 },
                god_ascendance: { early: 547, mid: 822, late: 1172, peak: 1597 }
            };
            
            var major = v.major_realm || "qi_gathering";
            var minor = v.minor_realm || "early";
            points = (realmPoints[major] && realmPoints[major][minor]) || 0;
            
            var majorNames = {
                qi_gathering: "Qi Gathering",
                foundation: "Foundation",
                core_formation: "Core Formation",
                martial_soul: "Martial Soul",
                god_ascendance: "God Ascendance"
            };
            var minorNames = { early: "Early", mid: "Mid", late: "Late", peak: "Peak" };
            levelDisplay = majorNames[major] + " " + minorNames[minor];
        }
        
        setAttrs({
            realm_points: points,
            path_display: pathDisplay,
            level_display: levelDisplay
        });
    });
});

// Realm stats tracking
on("change:power_realm change:agility_realm change:vitality_realm change:mental_realm change:qicontrol_realm change:cultspeed_realm", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    getAttrs(["power_realm", "agility_realm", "vitality_realm", "mental_realm", "qicontrol_realm", "cultspeed_realm"], function(v) {
        var spent = (parseInt(v.power_realm) || 0) + (parseInt(v.agility_realm) || 0) + (parseInt(v.vitality_realm) || 0) + (parseInt(v.mental_realm) || 0) + (parseInt(v.qicontrol_realm) || 0) + (parseInt(v.cultspeed_realm) || 0);
        setAttrs({ realm_spent: spent });
    });
});

// Final stats calculation
on("change:power_start change:power_realm change:agility_start change:agility_realm change:vitality_start change:vitality_realm change:mental_start change:mental_realm change:qicontrol_start change:qicontrol_realm change:cultspeed_start change:cultspeed_realm change:ancestry change:species", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    getAttrs(["power_start", "power_realm", "power_bonus", "agility_start", "agility_realm", "agility_bonus", "vitality_start", "vitality_realm", "vitality_bonus", "mental_start", "mental_realm", "mental_bonus", "qicontrol_start", "qicontrol_realm", "qicontrol_bonus", "cultspeed_start", "cultspeed_realm", "cultspeed_bonus"], function(v) {
        var updates = {
            power_final: (parseInt(v.power_start) || 0) + (parseInt(v.power_realm) || 0) + (parseInt(v.power_bonus) || 0),
            agility_final: (parseInt(v.agility_start) || 0) + (parseInt(v.agility_realm) || 0) + (parseInt(v.agility_bonus) || 0),
            vitality_final: (parseInt(v.vitality_start) || 0) + (parseInt(v.vitality_realm) || 0) + (parseInt(v.vitality_bonus) || 0),
            mental_final: (parseInt(v.mental_start) || 0) + (parseInt(v.mental_realm) || 0) + (parseInt(v.mental_bonus) || 0),
            qicontrol_final: (parseInt(v.qicontrol_start) || 0) + (parseInt(v.qicontrol_realm) || 0) + (parseInt(v.qicontrol_bonus) || 0),
            cultspeed_final: (parseInt(v.cultspeed_start) || 0) + (parseInt(v.cultspeed_realm) || 0) + (parseInt(v.cultspeed_bonus) || 0)
        };
        
        // Calculate milestones
        var pwr = updates.power_final;
        var pwr_ms = [];
        if (pwr >= 50) pwr_ms.push("+" + Math.floor(pwr/50)*20 + "% Phys Ret/Ctr");
        if (pwr >= 100) pwr_ms.push("+" + Math.floor(pwr/100)*10 + "% Phys Dmg");
        updates.power_milestones = pwr_ms.length ? pwr_ms.join(", ") : "None";
        
        var agi = updates.agility_final;
        var agi_ms = [];
        if (agi >= 15) agi_ms.push("+" + Math.floor(agi/15) + " Max AP");
        if (agi >= 150) agi_ms.push("+" + Math.floor(agi/150) + " AP Regen");
        updates.agility_milestones = agi_ms.length ? agi_ms.join(", ") : "None";
        
        var vit = updates.vitality_final;
        var vit_ms = [];
        if (vit >= 50) vit_ms.push("+" + Math.floor(vit/50)*5 + "% Max HP, +" + Math.floor(vit/50)*10 + " Dur");
        updates.vitality_milestones = vit_ms.length ? vit_ms.join(", ") : "None";
        
        var mtl = updates.mental_final;
        var mtl_ms = [];
        if (mtl >= 5) mtl_ms.push("+" + Math.floor(mtl/5) + " Mtl Fort");
        if (mtl >= 35) mtl_ms.push("+" + Math.floor(mtl/35) + " Tech Slots");
        if (mtl >= 50) mtl_ms.push("+" + Math.floor(mtl/50)*20 + "% Ret/Ctr");
        if (mtl >= 100) mtl_ms.push("+" + Math.floor(mtl/100) + " Moves");
        updates.mental_milestones = mtl_ms.length ? mtl_ms.join(", ") : "None";
        
        var qic = updates.qicontrol_final;
        var qic_ms = [];
        if (qic >= 40) qic_ms.push("-" + Math.floor(qic/40)*5 + "% Tech Cost");
        if (qic >= 50) qic_ms.push("+" + Math.floor(qic/50)*20 + "% Non-Phys Ret/Ctr");
        if (qic >= 100) qic_ms.push("+" + Math.floor(qic/100)*10 + "% Non-Phys Dmg");
        updates.qicontrol_milestones = qic_ms.length ? qic_ms.join(", ") : "None";
        
        var cul = updates.cultspeed_final;
        var cul_ms = [];
        if (cul >= 10) cul_ms.push("+" + Math.floor(cul/10)*5 + "% Cult Speed");
        updates.cultspeed_milestones = cul_ms.length ? cul_ms.join(", ") : "None";
        
        setAttrs(updates);
    });
});

// Sub-step navigation
on("clicked:stats_starting", function() {
    setAttrs({ 
        show_stats_starting: "1",
        show_stats_realm: "0",
        show_stats_finalize: "0"
    });
});

on("clicked:stats_realm", function() {
    setAttrs({ 
        show_stats_starting: "0",
        show_stats_realm: "1",
        show_stats_finalize: "0"
    });
});

on("clicked:stats_finalize", function() {
    setAttrs({ 
        show_stats_starting: "0",
        show_stats_realm: "0",
        show_stats_finalize: "1"
    });
});

// Handle ancestry changes - save modifiers
on("change:ancestry", function(eventInfo) {
    var ancestry = eventInfo.newValue || "";
    var mods = ancestryModifiers[ancestry] || { cultivation: 0, lifespan: 0 };
    
    var ancestryDisplay = ancestry ? ancestry.charAt(0).toUpperCase() + ancestry.slice(1) : "";
    
    setAttrs({
        species: "",
        bloodline_quality: "",
        ancestry_cultivation_percent: mods.cultivation,
        ancestry_lifespan_percent: mods.lifespan,
        anc_spe: ancestryDisplay
    });
});

on("change:species", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    getAttrs(["ancestry", "species"], function(values) {
        var ancestry = values.ancestry || "";
        var species = values.species || "";
        
        var ancestryDisplay = ancestry ? ancestry.charAt(0).toUpperCase() + ancestry.slice(1) : "";
        var display = ancestryDisplay;
        
        if (species && species !== "none") {
            var speciesDisplay = species.charAt(0).toUpperCase() + species.slice(1);
            display = ancestryDisplay + ": " + speciesDisplay;
        }
        
        setAttrs({ anc_spe: display });
    });
});

// Handle Cancel button
on("clicked:cancel_creation", function() {
    setAttrs({
        show_char_creation: "0",
        page: "mortal",
        character_type: "mortal",
        creation_step: "0"
    });
});

// Handle DONE button on character creation page
on("clicked:complete_char_creation", function() {
    setAttrs({
        show_char_creation: "0",
        page: "mortal",
        character_type: "mortal",
        creation_step: "0"
    });
});

// Handle Level Up / Realm Up button click
on("clicked:level_realm_up", function() {
    setAttrs({
        level_up_mode: "1",
        show_char_creation: "1",
        page: "char_creation",
        creation_step: "0"
    });
});

// Handle character type changes (mortal/cultivator)
on("change:character_type", function(eventInfo) {
    var charType = eventInfo.newValue;
    
    getAttrs(["is_beast", "page"], function(values) {
        if (values.is_beast !== "1") {
            var universalPages = ["combat", "techniques", "bio", "notes", "inventory", "options", "char_creation"];
            if (!universalPages.includes(values.page)) {
                setAttrs({ page: charType });
            }
        }
    });
});

// Handle beast mode toggle
on("change:is_beast", function(eventInfo) {
    var isBeast = eventInfo.newValue;
    
    getAttrs(["page"], function(values) {
        if (isBeast === "1") {
            if (values.page === "mortal" || values.page === "cultivator") {
                setAttrs({ page: "beast" });
            }
        } else {
            if (values.page === "beast") {
                getAttrs(["character_type"], function(vals) {
                    setAttrs({ page: vals.character_type || "mortal" });
                });
            }
        }
    });
});

// Handle character creation completion
on("change:show_char_creation", function(eventInfo) {
    if (eventInfo.newValue === "0") {
        getAttrs(["character_type", "is_beast"], function(values) {
            if (values.is_beast === "1") {
                setAttrs({ page: "beast" });
            } else {
                setAttrs({ page: values.character_type || "mortal" });
            }
        });
    }
});

// Clear stat assignment
on("clicked:clear_stat_assignment", function() {
    setAttrs({
        power_array: "0",
        agility_array: "0",
        vitality_array: "0",
        mental_array: "0",
        qicontrol_array: "0",
        cultspeed_array: "0",
        power_custom: 1,
        agility_custom: 1,
        vitality_custom: 1,
        mental_custom: 1,
        qicontrol_custom: 1,
        cultspeed_custom: 1,
        power_base: 1,
        agility_base: 1,
        vitality_base: 1,
        mental_base: 1,
        qicontrol_base: 1,
        cultspeed_base: 1
    });
});

// Reset stats when changing method
on("change:stat_method", function(eventInfo) {
    if (eventInfo.sourceType === "sheetworker") return;
    
    setAttrs({
        power_array: "0",
        agility_array: "0",
        vitality_array: "0",
        mental_array: "0",
        qicontrol_array: "0",
        cultspeed_array: "0",
        power_custom: 1,
        agility_custom: 1,
        vitality_custom: 1,
        mental_custom: 1,
        qicontrol_custom: 1,
        cultspeed_custom: 1,
        power_base: 1,
        agility_base: 1,
        vitality_base: 1,
        mental_base: 1,
        qicontrol_base: 1,
        cultspeed_base: 1
    });
});

// Update standard array assignments (no validation needed - only 3 options)
var statList = ["power", "agility", "vitality", "mental", "qicontrol", "cultspeed"];

statList.forEach(function(stat) {
    on("change:" + stat + "_array", function(eventInfo) {
        if (eventInfo.newValue) {
            setAttrs({ [stat + "_base"]: parseInt(eventInfo.newValue) || 1 });
        }
    });
});

// Update stats when custom values change
statList.forEach(function(stat) {
    on("change:" + stat + "_custom", function(eventInfo) {
        setAttrs({ [stat + "_base"]: parseInt(eventInfo.newValue) || 1 });
    });
});

// Calculate HP based on vitality
on("change:vitality_base", function(eventInfo) {
    var vit = parseInt(eventInfo.newValue) || 1;
    var hp = 10 + (vit * 5);
    setAttrs({ hp_max: hp });
});
</script>
